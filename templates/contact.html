{% extends "base.html" %}

{% block content %}
<!-- Contact/Quote section -->
<section class="contact-quote-section">
  <div class="contact-quote-container">
    <!-- Left side - Contact Info -->
    <div class="contact-info">
      <h2>Need Help With Your Shipping?</h2>
      <p>Our team is here to help you with all your logistics needs. Contact us today for a free quote.</p>
      
      <div class="contact-methods">
        <div class="contact-method">
          <div class="contact-icon">
            üìû
          </div>
          <div class="contact-details">
            <h4>Call Us Anytime</h4>
            <p>+94 21 492 7799</p>
          </div>
        </div>
        
        <div class="contact-method">
          <div class="contact-icon">
            ‚úâÔ∏è
          </div>
          <div class="contact-details">
            <h4>Email Us</h4>
            <p>info@stgfl.com</p>
          </div>
        </div>
        
        <div class="contact-method">
          <div class="contact-icon">
            üìç
          </div>
          <div class="contact-details">
            <h4>Visit Us</h4>
            <p>Ariviyal Nagar, Kilinochchi, Sri Lanka</p>
          </div>
        </div>

        <div class="contact-method">
            <div class="contact-icon">üïí</div>
            <div class="contact-details">
              <h4>Business Hours</h4>
              <p>Mon - Fri: 9:00 AM - 6:00 PM<br>
                 Sat: 9:00 AM - 2:00 PM<br>
                 Sun: Closed</p>
            </div>
          </div>
      </div>
    </div>
    
    <!-- Right side - Quote Form + Add Service -->
    <div class="quote-form">
      <h2>Get A Free Quote</h2>
      <p>Fill out the form below and our team will get back to you as soon as possible.</p>
      
      <form id="quoteForm" class="quote-form-container">
        <div class="form-row">
          <input id="qName" name="name" type="text" placeholder="Your Name" class="form-input" required>
          <input id="qEmail" name="email" type="email" placeholder="Your Email" class="form-input" required>
        </div>
        
        <input id="qSubject" name="subject" type="text" placeholder="Subject" class="form-input full-width" required>
        
        <select id="qService" name="service" class="form-input full-width" required>
          <option value="">Select Service</option>
          <option value="air-freight">Air Freight</option>
          <option value="ocean-freight">Ocean Freight</option>
          <option value="land-transport">Land Transport</option>
          <option value="warehousing">Warehousing</option>
        </select>
        
        <textarea id="qMessage" name="message" placeholder="Your Message" class="form-input full-width message-input" rows="4" required></textarea>
        
        <button id="qSubmit" type="submit" class="send-message-btn">Send Message</button>
        
        <button type="button" class="quote-submit-btn" aria-hidden="true" tabindex="-1">
          <i class="bi bi-arrow-up"></i>
        </button>
      </form>
      <div id="quoteStatus" class="inline-status" aria-live="polite"></div>
      <!-- Admin-only forms (Add Service / Add Feature) intentionally removed on public Contact page -->
    </div>
  </div>
</section>

<!-- Location Map section -->
<section class="location-map-section-fullscreen">
  <div class="map-container-fullscreen">
    <iframe 
      src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3949.123456789!2d80.39876!3d9.38472!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3afe1db0d5c0c5c5%3A0x1234567890abcdef!2sAriviyal%20Nagar%2C%20Kilinochchi%2C%20Sri%20Lanka!5e0!3m2!1sen!2slk!4v1234567890123!5m2!1sen!2slk&markers=color:red%7Clabel:A%7C9.38472,80.39876"
      width="100%" 
      height="500" 
      style="border:0;" 
      allowfullscreen="" 
      loading="lazy" 
      referrerpolicy="no-referrer-when-downgrade">
    </iframe>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script>
  (function() {
    const form = document.getElementById('quoteForm');
    const btn = document.getElementById('qSubmit');
    const statusEl = document.getElementById('quoteStatus');

    function setStatus(text, type) {
      statusEl.textContent = text || '';
      statusEl.className = 'inline-status ' + (type || '');
    }

    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      setStatus('', '');
      const payload = {
        name: document.getElementById('qName').value.trim(),
        email: document.getElementById('qEmail').value.trim(),
        subject: document.getElementById('qSubject').value.trim(),
        service: document.getElementById('qService').value,
        message: document.getElementById('qMessage').value.trim(),
      };
      if (!payload.name || !payload.email || !payload.subject || !payload.message) {
        setStatus('Please fill all required fields', 'error');
        return;
      }
      try {
        btn.disabled = true;
        const original = btn.textContent;
        btn.textContent = 'Sending...';
        const res = await fetch("{{ url_for('api_contact_message') }}", {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (!res.ok || !data.success) {
          throw new Error(data.error || 'Failed to send message');
        }
        setStatus('Message sent! We will get back to you shortly.', 'success');
        form.reset();
      } catch (err) {
        setStatus(err.message || 'Something went wrong. Please try again.', 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Send Message';
      }
    });
  })();

  /* Admin-only forms removed on public Contact page: no feature/service handlers */
</script>
<style>
  .inline-status { margin-top: 10px; font-size: 14px; }
  .inline-status.success { color: #16a34a; }
  .inline-status.error { color: #ef4444; }
</style>
{% endblock %}
